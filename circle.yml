machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - make

test:
  override:
    # Create index.php that will output the `phpinfo()`.
    - |
      mkdir src
      cat <<-EOL > src/index.php
      	<?php

      	phpinfo();
      EOL
      cat 5.6/configuration/nginx.conf
      cat src/index.php
    # tag: 5.6
    - |
      docker run -d -p 80:80 \
        -v $(pwd)/5.6/configuration:/docker/configuration \
        -v $(pwd)/src:/docker/src \
        -e APP_DIR=/docker/src \
        --name php-fpm \
        gullitmiranda/php-fpm; \
      sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:80
    - docker logs php-fpm
    - docker stop php-fpm
    # tag: 5.6-debian
    - |
      docker run -d -p 80:80 \
        -v $(pwd)/5.6/configuration:/docker/configuration \
        -v $(pwd)/src:/docker/src \
        -e APP_DIR=/docker/src \
        --name php-fpm-debian \
        gullitmiranda/php-fpm:5.6-debian; \
      sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:80
    - docker logs php-fpm-debian
    - docker stop php-fpm-debian

# deployment:
#   hub:
#     branch: master
#     commands:

#       # Authenticate with docker and push the latest image.

#       - docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASSWORD
#       - docker push gullitmiranda/php-fpm
